<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Donor Dashboard - Redlife</title>
    <link rel="stylesheet" th:href="@{/css/style.css}"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <script>
        const districtsByDivision = {
            'Dhaka': ['Dhaka', 'Faridpur', 'Gazipur', 'Gopalganj', 'Kishoreganj', 'Madaripur', 'Manikganj', 'Munshiganj', 'Narayanganj', 'Narsingdi', 'Rajbari', 'Shariatpur', 'Tangail'],
            'Chattogram': ['Bandarban', 'Brahmanbaria', 'Chandpur', 'Chattogram', 'Cumilla', 'Cox’s Bazar', 'Feni', 'Khagrachari', 'Lakshmipur', 'Noakhali', 'Rangamati'],
            'Khulna': ['Bagerhat', 'Chuadanga', 'Jashore', 'Jhenaidah', 'Khulna', 'Kushtia', 'Magura', 'Meherpur', 'Narail', 'Satkhira'],
            'Barishal': ['Barguna', 'Barishal', 'Bhola', 'Jhalokathi', 'Patuakhali', 'Pirojpur'],
            'Mymensingh': ['Jamalpur', 'Mymensingh', 'Netrokona', 'Sherpur'],
            'Rajshahi': ['Bogura', 'Joypurhat', 'Naogaon', 'Natore', 'Chapainawabganj', 'Pabna', 'Rajshahi', 'Sirajganj'],
            'Rangpur': ['Dinajpur', 'Gaibandha', 'Kurigram', 'Lalmonirhat', 'Nilphamari', 'Panchagarh', 'Rangpur', 'Thakurgaon'],
            'Sylhet': ['Habiganj', 'Moulvibazar', 'Sunamganj', 'Sylhet']
        };
        function updateDistricts() {
            const division = document.getElementById('division').value;
            const districtSelect = document.getElementById('district');
            districtSelect.innerHTML = '';
            if (districtsByDivision[division]) {
                districtsByDivision[division].forEach(function(district) {
                    const option = document.createElement('option');
                    option.value = district;
                    option.text = district;
                    districtSelect.appendChild(option);
                });
            }
        }
        function toggleLiveChatDiv() {
            const hidePhone = document.getElementById('hidePhoneNumber').checked;
            document.getElementById('liveChatDiv').style.display = hidePhone ? 'block' : 'none';
        }
    </script>
</head>
<body>
    <nav style="width:100%;background:#ffeaea;padding:12px 0 10px 0;box-shadow:0 2px 8px #e74c3c11;margin-bottom:10px;">
        <div style="max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:flex-start;">
            <a th:href="@{/}" style="color:#c0392b;font-weight:700;font-size:1.13em;text-decoration:none;padding:8px 22px;border-radius:8px;transition:background 0.2s;">&larr; Back to Home</a>
        </div>
    </nav>
    <!-- Move logout button to bottom, centered -->
    <div style="width:100%;display:flex;justify-content:center;margin:40px 0 0 0;">
        <a th:href="@{/logout}" class="logout-btn">Logout</a>
    </div>
    <div class="container">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
            <h2 class="dashboard-header">Donor Dashboard</h2>
            <div class="welcome-user">Welcome, <span th:text="${user.name}"></span></div>
        </div>
        <style>
.welcome-user {
    background: #ffeaea;
    color: #c0392b;
    font-weight: 700;
    font-size: 1.13em;
    border-radius: 8px;
    padding: 8px 22px;
    margin-left: 18px;
    box-shadow: 0 2px 8px #e74c3c11;
    letter-spacing: 0.5px;
}
</style>
        <!-- Button Group for Tabs -->
        <div id="dashboard-tabs" style="display:flex;gap:10px;margin-bottom:20px;">
            <button type="button" class="tab-btn" onclick="showTab('create')">Create Donation Post</button>
            <button type="button" class="tab-btn" onclick="showTab('my')">My Donation Posts</button>
            <button type="button" class="tab-btn" onclick="showTab('all')">All Donation Posts</button>
            <button type="button" class="tab-btn" onclick="showTab('need')">Need Blood Posts</button>
        </div>
        <script>
            function showTab(tab) {
                const tabs = ['create','my','all','need'];
                tabs.forEach(function(t) {
                    document.getElementById('tab-'+t).style.display = (t===tab)?'block':'none';
                });
                // Highlight active button
                document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active-tab'));
                document.querySelectorAll('.tab-btn')[tabs.indexOf(tab)].classList.add('active-tab');
            }
            window.onload = function() {
                showTab('create'); // Default tab
                if (typeof updateDistricts === 'function') updateDistricts();
                if (typeof toggleLiveChatDiv === 'function') toggleLiveChatDiv();
            };
        </script>
        <style>
            .tab-btn { padding:8px 18px; border:none; background:#ffeaea; color:#c0392b; border-radius:6px; font-weight:600; cursor:pointer; transition:background 0.2s; }
            .tab-btn.active-tab, .tab-btn:hover { background:#c0392b; color:#fff; }
        </style>
        <!-- Tab Contents -->
        <div id="tab-create">
            <div class="section-header" style="color:#c0392b; font-size:1.5em; font-weight:800; text-align:center; margin-bottom:18px;">Create Donation Post</div>
            <div class="donor-form-card">
                <form th:action="@{/donor/create-post}" method="post" class="form-grid">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Division:</label>
                            <select id="division" name="division" onchange="updateDistricts()" required>
                                <option value="">Select Division</option>
                                <option value="Dhaka">Dhaka</option>
                                <option value="Chattogram">Chattogram</option>
                                <option value="Khulna">Khulna</option>
                                <option value="Barishal">Barishal</option>
                                <option value="Mymensingh">Mymensingh</option>
                                <option value="Rajshahi">Rajshahi</option>
                                <option value="Rangpur">Rangpur</option>
                                <option value="Sylhet">Sylhet</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>District:</label>
                            <select id="district" name="district" required>
                                <option value="">Select District</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Area:</label>
                            <input type="text" name="area" required/>
                        </div>
                        <div class="form-group">
                            <label>Extra Note (optional):</label>
                            <input type="text" name="note"/>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group" style="flex:1 1 50%;max-width:50%;display:flex;align-items:center;background:#eafbe7;border-radius:8px;padding:10px 18px;">
                            <label style="margin-bottom:0;display:flex;align-items:center;gap:0.5em;">
                                <input type="checkbox" id="hidePhoneNumber" name="hidePhoneNumber" value="true" style="width:18px;height:18px;"/>
                                Hide Phone Number
                            </label>
                        </div>
                        <div class="form-group" style="flex:1 1 50%;max-width:50%;display:flex;align-items:center;justify-content:flex-end;">
                            <span style="background:#eafbe7;color:#27ae60;border-radius:8px;padding:10px 22px;font-weight:700;font-size:1.08em;display:inline-block;box-shadow:0 2px 8px #27ae6011;">✅ Live Chat ON</span>
                        </div>
                    </div>
                    <div class="form-row" style="justify-content:center;">
                        <button type="submit" class="donor-form-btn" style="margin:0 auto;">Create Donation Post</button>
                    </div>
                </form>
            </div>
        </div>
        <!-- Remove all inline <style> for tables and rely on .table-card, .table-title, and table CSS classes -->
<div id="tab-my" style="display:none;">
    <div class="table-card">
        <div class="table-title">My Donation Posts</div>
        <div class="table-container">
            <table>
                <thead>
                <tr>
                    <th>Division</th>
                    <th>District</th>
                    <th>Area</th>
                    <th>Blood Group</th>
                    <th>Phone</th>
                    <th>Note</th>
                    <th>Created</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="post : ${myPosts}">
                    <td data-label="Division" th:text="${post.division}"></td>
                    <td data-label="District" th:text="${post.district}"></td>
                    <td data-label="Area" th:text="${post.area}"></td>
                    <td data-label="Blood Group" th:text="${post.donor.bloodGroup}"></td>
                    <td data-label="Phone" th:text="${post.hidePhoneNumber} ? 'Hidden' : post.donor.phoneNumber"></td>
                    <td data-label="Note" th:text="${post.note}"></td>
                    <td data-label="Created" th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm')}"></td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
<div id="tab-all" style="display:none;">
    <div class="table-card">
        <div class="table-title">All Donation Posts</div>
        <div class="table-container">
            <table>
                <thead>
                <tr>
                    <th>Donor Name</th>
                    <th>Blood Group</th>
                    <th>Division</th>
                    <th>District</th>
                    <th>Area</th>
                    <th>Phone</th>
                    <th>Note</th>
                    <th>Created</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="post : ${allPosts}">
                    <td data-label="Donor Name" th:text="${post.donor.name}"></td>
                    <td data-label="Blood Group" th:text="${post.donor.bloodGroup}"></td>
                    <td data-label="Division" th:text="${post.division}"></td>
                    <td data-label="District" th:text="${post.district}"></td>
                    <td data-label="Area" th:text="${post.area}"></td>
                    <td data-label="Phone" th:text="${post.hidePhoneNumber} ? 'Hidden' : post.donor.phoneNumber"></td>
                    <td data-label="Note" th:text="${post.note}"></td>
                    <td data-label="Created" th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm')}"></td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
<div id="tab-need" style="display:none;">
    <div class="table-card">
        <div class="table-title">Need Blood Posts</div>
        <div class="table-container">
            <table>
                <thead>
                <tr>
                    <th>Receiver Name</th>
                    <th>Blood Group</th>
                    <th>Division</th>
                    <th>District</th>
                    <th>Area</th>
                    <th>Note</th>
                    <th>Phone</th>
                    <th>Live Chat</th>
                    <th>Created</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="need : ${needBloodPosts}">
                    <td data-label="Receiver Name" th:text="${need.receiver.name}"></td>
                    <td data-label="Blood Group" th:text="${need.bloodGroup}"></td>
                    <td data-label="Division" th:text="${need.division}"></td>
                    <td data-label="District" th:text="${need.district}"></td>
                    <td data-label="Area" th:text="${need.area}"></td>
                    <td data-label="Note" th:text="${need.note}"></td>
                    <td data-label="Phone" th:text="${need.hidePhoneNumber} ? 'Hidden' : need.receiver.phoneNumber"></td>
                    <td data-label="Live Chat">
                        <a th:href="@{/chat}" class="donor-form-btn" style="background:#fff;color:#c0392b;border:2px solid #c0392b;width:auto;min-width:90px;font-size:0.98em;padding:7px 0;">Live Chat</a>
                    </td>
                    <td data-label="Created" th:text="${#temporals.format(need.createdAt, 'yyyy-MM-dd HH:mm')}"></td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
    <script>
        window.onload = function() { updateDistricts(); toggleLiveChatDiv(); };
    </script>
    <style>
        .donor-form-card {
            background: #fff;
            border-radius: 18px;
            box-shadow: 0 8px 32px #e74c3c22;
            padding: 36px 28px 24px 28px;
            max-width: 480px;
            margin: 0 auto 24px auto;
        }
        .donor-form-btn {
            width: 100%;
            background: #c0392b;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 14px 0;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }
        .donor-form-btn:hover { background: #e74c3c; }
        .form-grid { display: flex; flex-direction: column; gap: 12px; }
        .form-row { display: flex; gap: 16px; }
        .form-group { flex: 1 1 0; display: flex; flex-direction: column; }
        .form-group label { color: #c0392b; font-weight: 600; margin-bottom: 4px; }
        .form-group input, .form-group select { padding: 10px; border-radius: 6px; border: 1.5px solid #f3d1d1; font-size: 1em; }
        @media (max-width: 700px) { .form-row { flex-direction: column; gap: 0; } .donor-form-card { padding: 16px 4vw; } }
    </style>
    <style>
    .logout-btn {
        background: #c0392b;
        color: #fff;
        border: none;
        border-radius: 8px;
        padding: 12px 32px;
        font-size: 1.12em;
        font-weight: 600;
        text-decoration: none;
        transition: background 0.2s;
        margin: 0 auto;
        display: inline-block;
    }
    .logout-btn:hover { background: #e74c3c; color: #fff; }
    </style>
</body>
</html> 